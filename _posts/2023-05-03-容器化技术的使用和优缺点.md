---
layout: post
title: "容器化技术的使用和优缺点"
tags: [docker]
excerpt_separator: <!--more-->
---

# 容器化技术的使用和优缺点
> 当前，容器化技术非常流行，各大小公司都在使用。那么容器化技术在实际项目中如何运用？有哪些优缺点？

## 容器化技术是什么
在容器化技术出现之前，部署系统非常麻烦，以一个简单的博客系统为例，博客系统设计如下：<!--more-->
1. 前后端分离，分别独立开发和部署
2. 前端使用vue，负责数据展示
3. 后端java，使用spring框架，负责业务逻辑处理，给前端提供接口
4. 数据库使用mariadb

这个系统该如何部署？
1. 数据库部署
   首先安装mariadb服务，再执行sql语句建库建表
2. 后端的部署
   先安装jdk。后端在构建后会生成jar包，因使用了spring框架，jar包是自带tomcat，配置好数据库地址和端口后，直接用java -jar命令运行即可  
3. 前端的部署
   前端在构建后会生成静态文件，即是html、js、css文件，同时需要调用后端接口获取数据，用于展示。那么就需要部署nginx，nginx的配置文件需要指定静态文件的位置，同时需要配置后端服务的代理地址。

部署图如下：  
![部署图](https://raw.githubusercontent.com/leanfish2011/data/main/img/old_dploy.png)

 这样部署有以下几个问题：
 1. 需要手动安装mariadb、jdk、nginx。可能遇到安装包损坏、权限不够等各种问题，且每个新环境都需要重新安装一遍。
 2. 手动执行sql语句，手动配置nginx，手动配置mariadb连接地址等。很容易配置错误，每个新环境都需要重新配置一遍。
 3. 升级需要替换jar包、前端静态文件等，非常复杂。

有没有一种方案能解决上述重复安装、重复配置、升级麻烦的苦恼？  
有！  
那就是容器化技术，代表技术是虚拟机和Docker  
虚拟机大家都用过。在电脑上安装虚拟机软件，再安装操作系统，再安装其他需要的环境。再部署应用，其他地方需要部署的话，则将虚拟机文件拷贝到其他机器上。  
Docker是个划时代的技术，它极大提高了应用的维护效率，降低了应用开发的成本！使用Docker，可以让应用的部署、测试和分发都变得前所未有的轻松！  
什么是Docker，这里只做一个简单的介绍，详细的内容请查看<a href="https://www.docker.com" target="_blank">Docker官网</a>  
Docker基于Linux内核的cgroup、namespace，以及OverlayFS类的Union FS等技术，对进程进行封装隔离，属于操作系统层面的虚拟化技术，使得Docker技术比虚拟机技术更为轻便、快捷。  

下面的图片比较了Docker和传统虚拟化方式的不同之处。传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；而容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核，而且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。

传统虚拟化  
![传统虚拟化](https://raw.githubusercontent.com/leanfish2011/data/main/img/vm.png)

Docker  
![Docker](https://raw.githubusercontent.com/leanfish2011/data/main/img/docker.png)

Docker同传统的虚拟化技术相比，有以下优点：
- 更高效的利用系统资源
- 更快速的启动时间
- 一致的运行环境
- 持续交付和部署
- 更轻松的迁移
- 更轻松的维护和扩展

对比总结如下：

| 特性 | 容器 | 虚拟机 |
| --------- | -------------- | ------- |
| 启动       | 秒级             | 分钟级    |
| 硬盘使用    | 一般为MB         | 一般为GB  |
| 性能       | 接近原生         | 弱于      |
| 系统支持量  | 单机支持上千个容器 | 一般几十个 |

## 容器化技术怎么用
主要需要做两个事情：
1. docker安装
   首先需要安装docker环境，Docker官网有安装教程，Linux、Mac、Windows都支持。
2. 镜像构建
   镜像是docker运行的基础，应用系统交付物即是镜像。镜像是一个特殊的文件，包含了运行时所需的程序、库、资源、配置、环境变量等参数。例如后端镜像，就包含了Linux及jdk环境。

以上面提到的博客系统为例，讲解Docker如何使用  
1. mariadb镜像的构建  
直接使用DockerHub中已经构建好的mariadb镜像，本地可以拉取镜像，打上自己的tag  
```
# 构建mariadb基础镜像
sudo docker pull mariadb:latest
sudo docker tag mariadb:latest mariadb:20200329_204923
```
2. mariadb初始化镜像的构建 


## 总结


